<!-- [모달] 원재료 등록/수정 (통합) -->
<!-- z-index를 [60]으로 설정하여 상세내역 팝업(z-50) 위에 뜨도록 수정 -->
<div id="modal-material" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden flex items-end sm:items-center justify-center">
  <div class="bg-white w-full sm:w-96 rounded-t-2xl sm:rounded-2xl p-6 fade-in shadow-2xl">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-800" id="material-modal-title">원재료 입출고 등록</h3>
      <button onclick="closeModal('modal-material')" class="text-gray-400 hover:text-gray-600"><span class="material-icons">close</span></button>
    </div>
    <form onsubmit="submitMaterial(event)" class="space-y-4" id="form-material">
      <!-- 수정 시 ID(rowIndex) 저장용 히든 필드 -->
      <input type="hidden" name="rowIndex" id="material-rowIndex">
      
      <div><label class="block text-xs font-bold text-gray-500 mb-1">날짜</label><input type="date" name="date" id="material-date" required class="w-full border border-gray-300 rounded-lg p-2 text-sm outline-none focus:border-orange-500"></div>
      <div class="flex space-x-2">
        <!-- [CHANGED] 품목명 입력을 Dropdown으로 변경 -->
        <div class="w-2/3">
          <label class="block text-xs font-bold text-gray-500 mb-1">품목명</label>
          <select name="item" id="input-material-item" required class="w-full border border-gray-300 rounded-lg p-2 text-sm bg-white outline-none focus:border-orange-500">
            <option value="" disabled selected>선택하세요</option>
          </select>
        </div>
        <div class="w-1/3"><label class="block text-xs font-bold text-gray-500 mb-1">구분</label><select name="type" id="material-type" class="w-full border border-gray-300 rounded-lg p-2 text-sm bg-white outline-none focus:border-orange-500"><option value="입고">입고</option><option value="출고">출고</option></select></div>
      </div>
      <div><label class="block text-xs font-bold text-gray-500 mb-1">수량</label><input type="number" name="qty" id="material-qty" placeholder="0" required class="w-full border border-gray-300 rounded-lg p-2 text-sm outline-none focus:border-orange-500"></div>
      <div><label class="block text-xs font-bold text-gray-500 mb-1">로트번호</label><input type="text" name="lot" id="material-lot" placeholder="Lot No. 입력" class="w-full border border-gray-300 rounded-lg p-2 text-sm outline-none focus:border-orange-500"></div>
      <div><label class="block text-xs font-bold text-gray-500 mb-1">내역</label><input type="text" name="desc" id="material-desc" placeholder="상세 내용 입력" class="w-full border border-gray-300 rounded-lg p-2 text-sm outline-none focus:border-orange-500"></div>
      <button type="submit" id="btn-save-material" class="w-full bg-orange-500 text-white font-bold py-3 rounded-xl hover:bg-orange-600 transition-colors shadow-md mt-2 flex justify-center items-center">저장하기</button>
    </form>
  </div>
</div>

<!-- [모달] 원재료 상세 내역 -->
<div id="modal-material-detail" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
  <div class="bg-white w-full sm:w-96 max-h-[90vh] rounded-2xl shadow-2xl flex flex-col fade-in overflow-hidden">
    <div class="p-4 border-b border-gray-100 bg-gray-50">
      <div class="flex justify-between items-start mb-2">
        <h3 class="text-xl font-bold text-gray-800" id="detail-title">원재료명</h3>
        <button onclick="closeModal('modal-material-detail')" class="text-gray-400 hover:text-gray-600 p-1">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="flex justify-between items-center mb-2">
          <p class="text-xs text-gray-500 font-bold">로트별 상세 재고 이력</p>
          <label for="toggle-detail-zero" class="flex items-center cursor-pointer">
          <div class="relative">
            <input type="checkbox" id="toggle-detail-zero" class="sr-only" onchange="updateDetailView()" checked>
            <div class="block bg-gray-200 w-8 h-5 rounded-full transition"></div>
            <div class="dot absolute left-1 top-1 bg-white w-3 h-3 rounded-full transition"></div>
          </div>
          <div class="ml-2 text-[10px] text-gray-500 font-bold">재고 0 숨기기</div>
        </label>
      </div>
      <div class="flex items-center space-x-2 bg-white p-2 rounded-lg border border-gray-200">
        <div class="relative flex-grow"><input type="date" id="detail-date-start" onchange="updateDetailView()" class="w-full text-xs font-bold text-gray-600 bg-transparent outline-none"></div>
        <span class="text-gray-400 text-xs">~</span>
        <div class="relative flex-grow"><input type="date" id="detail-date-end" onchange="updateDetailView()" class="w-full text-xs font-bold text-gray-600 bg-transparent outline-none text-right"></div>
      </div>
    </div>
    <div class="px-4 py-3 bg-white border-b border-gray-50">
      <div id="detail-lot-chips" class="flex space-x-2 overflow-x-auto hide-scroll"></div>
    </div>
    <div id="detail-content" class="px-4 pb-4 pt-3 overflow-y-auto space-y-3 bg-white flex-grow"></div>
    <div class="p-4 border-t border-gray-100 bg-gray-50 flex-shrink-0">
        <button onclick="closeModal('modal-material-detail')" class="w-full bg-gray-100 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-200 transition-colors">닫기</button>
    </div>
  </div>
</div>
